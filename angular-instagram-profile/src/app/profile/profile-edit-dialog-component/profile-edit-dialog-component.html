<p-dialog [modal]="true" [(visible)]="userService.visibleEditDialog">
  <form [formGroup]="userService.userForm" class="h-auto overflow-visible">
    <div class="my-5 d-flex align-content-center">
      <p-fileupload
        name="demo"
        url="https://www.primefaces.org/cdn/api/upload.php"
        [multiple]="false"
        accept="image/*"
        maxFileSize="1000000"
        mode="basic"
        (onUpload)="userService.uploadFile($event, userService.userForm.controls.pfpUrl)"
        class="fileupload-edit-pfp h-50"
        [cancelLabel]="''"
        [uploadLabel]="''"
        [chooseLabel]="' '"
        chooseIcon="pi pi-user-edit"
        [showCancelButton]="false"
        [showUploadButton]="false"
        [auto]="true"
        [chooseButtonProps]="{
              icon: 'pi pi-user-clock',
              outlined: true,
              rounded: true,
            }"
      >
      </p-fileupload>
      <p-avatar
        [shape]="'circle'"
        [image]="userService.user()?.pfpUrl || 'sunnyDay.jpg'"
        class="img-pfp my-4"
      />
    </div>
    <p-input-group class="p-2">
      <p-inputgroup-addon><i class="pi pi-user"></i> </p-inputgroup-addon>
      <input
        [formControl]="userService.userForm.controls.username"
        class=""
        pInputText
        type="text"
        name="username"
        placeholder="Username"
        [placeholder]="userService.user()?.username"
      />
    </p-input-group>

    <p-input-group class="p-2">
      <p-inputgroup-addon>
        <p-button
          (onClick)="userService.useEmail = true"
          class="h-100"
          [disabled]="userService.useEmail === true"
          ><svg
            class=""
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="#fefbfb"
            viewBox="0 0 256 256"
          >
            <path
              d="M128,24a104,104,0,0,0,0,208c21.51,0,44.1-6.48,60.43-17.33a8,8,0,0,0-8.86-13.33C166,210.38,146.21,216,128,216a88,88,0,1,1,88-88c0,26.45-10.88,32-20,32s-20-5.55-20-32V88a8,8,0,0,0-16,0v4.26a48,48,0,1,0,5.93,65.1c6,12,16.35,18.64,30.07,18.64,22.54,0,36-17.94,36-48A104.11,104.11,0,0,0,128,24Zm0,136a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z"
            ></path>
          </svg>
        </p-button>
      </p-inputgroup-addon>
      @if (userService.useEmail) {

      <input
        size="large"
        type="text"
        [formControl]="userService.userForm.controls.email"
        pInputText
        class="inputmask-credentials"
        [placeholder]="userService.user()?.email"
      />

      }@else{

      <p-inputmask
        [mask]="'(+999)99-999-9999'"
        size="large"
        type="text"
        [formControl]="userService.userForm.controls.phoneNumber"
        pInputText
        class="inputmask-credentials"
        [placeholder]="userService.user()?.phoneNumber"
      />
      }
      <p-inputgroup-addon>
        <p-button
          (onClick)="userService.useEmail = false"
          icon="pi pi-phone"
          class="h-100"
          [disabled]="userService.useEmail === false"
        />
      </p-inputgroup-addon>
    </p-input-group>

    <div class="w-100 d-flex justify-content-start mb-3">
      <p-input-group class="w-75 px-0 py-2">
        <p-inputgroup-addon>
          <i class="pi pi-calendar"></i>
        </p-inputgroup-addon>
        <p-date-picker
          appendTo="body"
          placeholder="Your Birth Date"
          [formControl]="userService.userForm.controls.dateOfBirth"
          class=""
          [showButtonBar]="true"
          size="large"
          dateFormat="dd/mm/yy"
          [maxDate]="userService.today"
          placeholder="{{ userService.user()?.dateOfBirth | date }}"
        />
      </p-input-group>
      <p-selectbutton
        [options]="userService.genderOptions"
        class="selectbutton-gender"
        [formControl]="userService.userForm.controls.gender"
      />
    </div>

    <!--! Business Account  -->
    @if(userService. user()?.accountType==='business'){
    <div class="d-flex gap-4">
      <div>
        <p-input-group class="w-100 mb-4 d-flex">
          <p-inputgroup-addon>
            <i class="pi pi-search" (click)="userService.updateSuggestedCities($event)"></i>
          </p-inputgroup-addon>
          <p-autocomplete
            [formControl]="userService.userForm.controls.city"
            [suggestions]="userService.suggestedCities"
            appendTo="body"
            [placeholder]="userService.user()?.city"
            (completeMethod)="userService.updateSuggestedCities($event)"
          />
        </p-input-group>
        <p-input-group class="my-4">
          <p-inputgroup-addon
            ><i
              ><svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="#ffffff"
                viewBox="0 0 256 256"
                data--h-bstatus="0OBSERVED"
              >
                <path
                  d="M24,104H48v64H32a8,8,0,0,0,0,16H224a8,8,0,0,0,0-16H208V104h24a8,8,0,0,0,4.19-14.81l-104-64a8,8,0,0,0-8.38,0l-104,64A8,8,0,0,0,24,104Zm40,0H96v64H64Zm80,0v64H112V104Zm48,64H160V104h32ZM128,41.39,203.74,88H52.26ZM248,208a8,8,0,0,1-8,8H16a8,8,0,0,1,0-16H240A8,8,0,0,1,248,208Z"
                  data--h-bstatus="0OBSERVED"
                ></path></svg></i
          ></p-inputgroup-addon>
          <input
            [formControl]="userService.userForm.controls.iban"
            pInputText
            [placeholder]="userService.user()?.iban"
          />
        </p-input-group>
        <p-input-group class="my-4">
          <p-inputgroup-addon><i class="pi pi-file"></i></p-inputgroup-addon>
          <input
            [formControl]="userService.userForm.controls.commercialRegistryNumber"
            type=""
            [placeholder]="userService.user()?.commercialRegistryNumber"
            pInputText
          />
        </p-input-group>
      </div>
      <div class="d-flex flex-column justify-content-center align-items-center">
        <p-fileupload
          name="demo"
          url="https://www.primefaces.org/cdn/api/upload.php"
          [multiple]="true"
          accept="application/pdf"
          maxFileSize="1000000"
          mode="advanced"
          [cancelLabel]="' '"
          [cancelIcon]="' '"
          [uploadLabel]="' '"
          [uploadIcon]="' '"
          [chooseLabel]="'Upload'"
          [chooseIcon]="'pi pi-upload'"
          [auto]="true"
          (onUpload)="userService.uploadFile($event, userService.userForm.controls.commercialPaper)"
        >
          <ng-template #content>
            <div class="d-flex justify-content-center">
              @if( userService. userForm.controls.commercialPaper.value){

              <a [href]="userService.userForm.controls.commercialPaper.value" target="_blank"
                >View</a
              >
              }
            </div>
          </ng-template>
        </p-fileupload>
      </div>
    </div>
    <h2>Payment Methods</h2>
    <div class="d-flex justify-content-between flex-wrap my-5">
      <div class="d-flex w-100 justify-content-center align-items-center gap-5">
        @for (method of userService.paymentMethodsOptions ; track $index) {
        <div class="d-flex gap-2">
          <label class="payment-radio" for="paymentMethods">{{ method }}</label>
          <p-checkbox
            [formControl]="userService.userForm.controls.paymentMethods"
            [value]="userService.user()?.paymentMethods?.at($index) ?? method"
          />
        </div>

        }
      </div>
    </div>

    <div>
      <div class="w-100 my-4">
        <h2>Open hours</h2>

        @for (group of userService. userForm.controls.workHours.controls; track $index) {

        <div
          class="div-openHours w-100 d-flex justify-content-start align-items-center gap-5 m-4 my-5"
        >
          <div class="w-25 d-flex justify-content-between gap-2">
            <span class="span-work-day fw-bolder">{{ group.value.day }}</span>

            <p-checkbox
              size="large"
              [formControl]="group.controls.available"
              binary="true"
            ></p-checkbox>
          </div>

          <p-datepicker
            [iconDisplay]="'button'"
            [showIcon]="true"
            icon="pi pi-clock"
            [appendTo]="'body'"
            class="date-picker-work-hours"
            [timeOnly]="true"
            [formControl]="group.controls.openHours"
          >
            <ng-template #footer>
              <div class="d-flex gap-3">
                <span class="">Flexible</span>
                <p-checkbox [binary]="true" [formControl]="group.controls.flexible" />
              </div>
            </ng-template>
          </p-datepicker>
          <span>To</span>
          <p-datepicker
            [iconDisplay]="'button'"
            [showIcon]="true"
            icon="pi pi-clock"
            hourFormat="hh:mm"
            [appendTo]="'body'"
            class="date-picker-work-hours"
            [timeOnly]="true"
            [formControl]="group.controls.closeHours"
            [placeholder]="(userService.user()?.workHours)![$index].closeHours || ''"
          >
          </p-datepicker>
        </div>
        }
      </div>
    </div>
    }
    <!--! Personal account code  -->
    @else{
    <p-input-group class="w-100 my-4 d-flex">
      <p-inputgroup-addon>
        <i class="pi pi-search" (click)="userService.updateSuggestedCities($event)"></i>
      </p-inputgroup-addon>
      <p-autocomplete
        [suggestions]="userService.suggestedCities"
        appendTo="body"
        placeholder="Select your city"
        (completeMethod)="userService.updateSuggestedCities($event)"
      />
    </p-input-group>
    <div class="d-flex flex-column">
      <label for="bio">bio</label>
      <textarea rows="5" cols="30" pTextarea></textarea>
    </div>

    }
    <div class="d-flex g-2 justify-content-center gap-5 my-5">
      <p-button
        label="Cancel"
        (onClick)="userService.visibleEditDialog = false"
        severity="secondary"
      />
      <p-button label="Save" (onClick)="submitForm()" severity="success" />
    </div>
  </form>
</p-dialog>
